<% content_for :title, "Products" %>

<h1>Products</h1>

<div id="products">
  <% @products.each do |product| %>
    <%= render product %>
    <p>
      <% if current_user %>
        <% sale_item = current_sale.sale_items.find_by(product_id: product.id) %>
        <% if sale_item %>
          <p><strong>En el carrito</strong> <%= sale_item.quantity %></p>
        <% else %>
          <%= form_with(model: [current_sale, SaleItem.new], local: true) do |f| %>
            <%= f.label :quantity %>
            <%= f.number_field :quantity, min: 1 %>
            <%= f.hidden_field :product_id, value: product.id %>
            <%= f.hidden_field :price, value: product.price %>
            <%= f.submit "Agregar al carrito" %>
          <% end %>
        <% end %>
      <% end %>
    </p>
    <p><%= link_to "Show this product", product %></p>
  <% end %>
</div>

<%= link_to "New product", new_product_path %>
